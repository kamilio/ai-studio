We're adding a video feature to the app. The model generates clips of a fixed length (6â€“12 seconds) and we stitch them together into a final video.

## Navigation & Routes

Video is a third tab on the shared home (`/`) alongside Music and Image. Routes:

| Route | Page |
|---|---|
| `/video` | Video home (no TopBar) |
| `/video/scripts` | All scripts |
| `/video/scripts/:id` | Script editor |
| `/video/videos` | All generated videos (cross-script) |
| `/video/videos/pinned` | Pinned videos |
| `/video/templates` | Global templates |

The NavMenu (top-right `[â—‹]`) for video pages shows: Scripts, All Videos, Pinned Videos, Templates, Settings.

## UI & Data Model

The UI will be very different from image or music. The main entity is a **script**. Each script contains multiple **shots** (1â€“N). A shot is the filmmaking term for a single continuous video clip (6â€“12 seconds). Each shot can have N generated videos, but we pick only one as the selected take. The rationale is that it typically takes several attempts and prompt iterations to get a good result.

Shots are **drag-and-drop reorderable**. Shot numbers are index-based only (no fixed labels).

Each shot has:
- **Video prompt** â€” the main text prompt sent to the video model
- **Narration** â€” optional text. If empty, nothing happens.
- **"Use sound from video"** toggle â€” on by default. When turned off, narration is enabled and rendered via ElevenLabs.

## Flow

The user writes a natural language prompt (e.g. "I want a 2-minute video about X"). We use Claude Sonnet to generate a YAML file â€” the script. The YAML is the core artifact. Editing it works similarly to music: chat on the right, the full script rendered nicely on the left.

The YAML is not stored as a file â€” it is a **rendered representation of internal state**, generated on demand.

## YAML Format

The YAML is the canonical representation of a script. It is expressive enough to fully reconstruct the editor state.

```yaml
title: Lemonade Stand Explainer
created_at: 2024-01-15T10:00:00Z

settings:
  subtitles: true
  default_audio: video          # video | elevenlabs

templates:
  Maya:
    category: character
    global: false
    value: "a young woman in her mid-20s with curly auburn hair, yellow apron, friendly smile, freckles, photorealistic"
  style_cinematic:
    category: style
    global: true
    value: "Isometric 2.5D corporate explainer. Navy, coral, gold palette. Minimal faces, vector style."
  scenery_kitchen:
    category: scenery
    global: false
    value: "warm farmhouse kitchen, wooden countertops, bright natural light overhead"

shots:
  - title: Opening â€” The Lemon Tree
    prompt: "{{Maya}} walks through a sunlit lemon grove. {{style_cinematic}}, golden hour light."
    narration:
      enabled: true
      text: "Meet Ana and Ben. They both sell lemonade at the same market."
      audio: elevenlabs           # elevenlabs | video (overrides settings.default_audio)
      audio_url: "https://cdn.poe.com/audio/abc123.mp3"
    video:
      selected_url: "https://cdn.poe.com/video/xyz789.mp4"
      history:
        - url: "https://cdn.poe.com/video/xyz789.mp4"
          generated_at: 2024-01-15T10:30:00Z
          pinned: false
        - url: "https://cdn.poe.com/video/old456.mp4"
          generated_at: 2024-01-15T09:15:00Z
          pinned: true

  - title: Harvest â€” Picking & Sorting
    prompt: "Close-up of hands sorting fresh lemons on a wooden table. {{style_cinematic}}."
    narration:
      enabled: false
    video:
      selected_url: null
      history: []
```

Notes:
- `templates` in the YAML = local templates for this script. Global templates are stored separately and merged at render time; they are **not** written into the YAML.
- `narration.audio` overrides `settings.default_audio` per shot.
- `video.history` entries include `pinned: true` so pins survive YAML round-trips.

## Script Editor Modes

The script editor has two modes, toggled in the **left panel header**:

1. **Write mode** â€” view and edit all shots in the script at once. Shots are drag-and-drop reorderable.
2. **Shot mode** â€” zoom into a single shot. From here you can edit the prompt and generate videos. The default is 1 generation per run, up to 3. When you pick a video it becomes the selected URL for that shot; the rest remain in history.

## Narration Audio

A **Generate Audio** button appears only when narration is enabled **and** audio source is set to ElevenLabs. It is hidden when narration is off or when "use sound from video" is selected.

Audio is generated on demand per shot. Files longer than the shot's video duration are automatically rejected and the user is prompted to regenerate.

## Video Generation Scope

The web app generates **individual shot videos** (6â€“12 second clips) via the video model API. This is fully supported â€” the GENERATE button in Shot mode is live.

What the web app does **not** do: stitch clips into a final video. That is handled externally by the Python generation script + server (ffmpeg/pyvideo). Generation in the web app is synchronous â€” no background job queue; the UI waits for the response.

## Export

Export = **download the YAML file**. The user can then feed it into the Python generation script to produce the final stitched video.

## Videos List & Pinned Videos

Since video generation is expensive, users can **pin** individual generated videos (not just the selected one â€” any video in a shot's history). Pinning is available from **both** the shot's video history grid in the editor and from the All Videos page. Pinned videos appear in the dedicated Pinned Videos page. The All Videos page shows every generated video across all scripts with metadata (script name, shot index, timestamp).

## Variables & Templates

Prompts use Handlebars templating syntax (`{{variable_name}}`). The prompt editor needs syntax highlighting and autocomplete (triggered by typing `{{`). Templates have **two scopes**:

- **Global templates** â€” accessible from the main NavMenu â†’ Templates (`/video/templates`). Available in all scripts.
- **Local templates** â€” scoped to the current script. Stored in the script YAML under `templates` with `global: false`. Managed via **Templates mode** in the script editor.

**Accessing templates in the editor â€” three entry points:**

1. **`{{` autocomplete** â€” dropdown divided into two sections. "Script templates" appears first (more relevant). A divider line labeled "Global templates" separates the second section. If the script has no local templates, the divider is omitted and only globals show.
2. **Template chips row** â€” subtle row below each prompt textarea listing local template variables as clickable chips. Click to insert `{{variable_name}}` at cursor. Low-prominence (muted, small). Globals not shown here.
3. **Templates mode** â€” the left panel toggle gains a third option: `[Write] [Shot] [Templates]`. When active, the left panel shows local template management for this script. Same card layout as the global Templates page but scoped. Panel heading reads `SCRIPT TEMPLATES`. Variables created here are written to the YAML with `global: false`.

Each template variable has a boolean `global` flag. Categories: **Characters**, **Style**, **Scenery**.

## Video Playback

Video history thumbnails use an **inline `<video>` player** (not a static thumbnail or new-tab link). The player is compact â€” shows the first frame as poster, plays on hover or click.

## Server

There will be a server for video assembly. It does not use LLMs â€” it only runs ffmpeg and pyvideo to merge and stitch clips.

## Generation Script

We're writing the generation script directly. Two boolean flags:
- **Subtitles** â€” whether to burn subtitles into the video
- **Audio source** â€” ElevenLabs narration vs. native video audio

## Mobile

Responsive breakpoint matches music editor (768px). Below breakpoint: tab-based layout, **Script pane is the default tab**.

---

# UI Mockups

> Layout notes: no sidebar â€” navigation is via the top-right circle NavMenu `[â—‹]`. TopBar: `[â–£ Studio]  [Breadcrumb â€” flex-1]  [234 pts]  [â—‹]`. Home pages (/video) have no TopBar, matching /music and /image. Panel headings uppercase (SCRIPT, CHAT). Chat: user messages right-aligned in bubble, assistant left-aligned in card.

## Page 1 â€” Video Home (/video)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                [â—‹]     â”‚
â”‚                                                                                        â”‚
â”‚                                â”Œâ”€â”€â”€â”                                                   â”‚
â”‚                                â”‚ â–¶ â”‚  Studio                                           â”‚
â”‚                                â””â”€â”€â”€â”˜                                                   â”‚
â”‚                     Create a script, generate shots, export video.                     â”‚
â”‚                                                                                        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚          â”‚                                                                  â”‚          â”‚
â”‚          â”‚  A 60-second explainer video about lemonade economics,          â”‚          â”‚
â”‚          â”‚  upbeat and sunny. Use brand character {{Maya}} throughout.     â”‚          â”‚
â”‚          â”‚                                                                  â”‚          â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          Tip: include desired length, tone, characters, and style                      â”‚
â”‚                                                               [âœ¨ Generate Script]      â”‚
â”‚                                                                                        â”‚
â”‚          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  RECENT SCRIPTS  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚                                                                                        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚          â”‚  Lemonade Stand Explainer      â”‚   â”‚  Summer Vibes Promo            â”‚      â”‚
â”‚          â”‚  6 shots Â· ~48 sec             â”‚   â”‚  4 shots Â· ~32 sec             â”‚      â”‚
â”‚          â”‚  Updated 2 hours ago           â”‚   â”‚  Updated yesterday             â”‚      â”‚
â”‚          â”‚  [Edit]    [â‹¯]                 â”‚   â”‚  [Edit]    [â‹¯]                 â”‚      â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Page 2 â€” All Scripts (/video/scripts)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â–£] Studio    Video Scripts                                       234 pts   [â—‹]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚  â”‚                       â”‚     â”‚
â”‚   â”‚  â•‘                 â•‘  â”‚  â”‚  â•‘                 â•‘  â”‚  â”‚          +            â”‚     â”‚
â”‚   â”‚  â•‘   [ preview ]   â•‘  â”‚  â”‚  â•‘   [ preview ]   â•‘  â”‚  â”‚     New Script        â”‚     â”‚
â”‚   â”‚  â•‘                 â•‘  â”‚  â”‚  â•‘                 â•‘  â”‚  â”‚                       â”‚     â”‚
â”‚   â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚  â”‚                       â”‚     â”‚
â”‚   â”‚                       â”‚  â”‚                       â”‚  â”‚                       â”‚     â”‚
â”‚   â”‚  Lemonade Stand       â”‚  â”‚  Summer Vibes Promo   â”‚  â”‚                       â”‚     â”‚
â”‚   â”‚  6 shots Â· ~48s       â”‚  â”‚  4 shots Â· ~32s       â”‚  â”‚                       â”‚     â”‚
â”‚   â”‚  Updated 2h ago       â”‚  â”‚  Updated yesterday    â”‚  â”‚                       â”‚     â”‚
â”‚   â”‚  [Edit]    [â‹¯]        â”‚  â”‚  [Edit]    [â‹¯]        â”‚  â”‚                       â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Page 3 â€” Script Editor, Write Mode

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â–£] Studio    Video Scripts / Lemonade Stand Explainer        234 pts   [â—‹]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SCRIPT  Â·  [Write â—] [Shot â—‹] [Tmpl â—‹]  [+ Shot]â”‚  CHAT                               â”‚
â”‚                                                  â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚â‹®â‹® Shot 1 Â· Opening â€” The Lemon Tree [â‹¯â–¾]â”‚   â”‚  â”‚ Here's your 6-shot script. â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  â”‚ Structured grove-to-glass. â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚ Let me know what to adjust.â”‚    â”‚
â”‚  â”‚ â”‚ {{Maya}} walks through a sunlit    â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚ â”‚ lemon grove. {{style_cinematic}}.  â”‚   â”‚   â”‚                                     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [Maya] [style_cinematic] [kitchen] +add  â”‚   â”‚       â”‚ make shot 3 a montage   â”‚   â”‚
â”‚  â”‚ Narration [off]  â—Video  â—‹ElevenLabs     â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚ [â–¶ shot-001-v2.mp4 âœ“]   [â†’ Shot view]   â”‚   â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                     â”‚
â”‚                                                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ Updated Shot 3! Rapid cuts  â”‚    â”‚
â”‚  â”‚â‹®â‹® Shot 2 Â· Harvest                [â‹¯ â–¾] â”‚   â”‚  â”‚ and dynamic angles.         â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚                                     â”‚
â”‚  â”‚ â”‚ Close-up: hands sorting lemons.    â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â”‚ {{style_vibrant}} tones.           â”‚   â”‚   â”‚  â”‚ Type a message...  [Send â†µ]   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ [style_vibrant] [Maya] [kitchen] +add    â”‚   â”‚                                     â”‚
â”‚  â”‚ Narration [on ]  â—‹Video  â—ElevenLabs     â”‚   â”‚                                     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚                                     â”‚
â”‚  â”‚ â”‚ "Great lemonade starts with great  â”‚   â”‚   â”‚                                     â”‚
â”‚  â”‚ â”‚  lemons."                          â”‚   â”‚   â”‚                                     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚                                     â”‚
â”‚  â”‚ [ğŸ™ Generate Audio]  audio-v1.mp3 4.1s   â”‚   â”‚                                     â”‚
â”‚  â”‚ [â–¶ shot-002-v1.mp4 âœ“]   [â†’ Shot view]   â”‚   â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                     â”‚
â”‚                                                  â”‚                                     â”‚
â”‚  [ + Add Shot ]          â‹®â‹® = drag to reorder   â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Subtitles [â—] On    6 shots Â· ~48s    [â–¶ Preview All]            [â¬‡ Export Video]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Page 4 â€” Script Editor, Shot Mode (Shot 3)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â–£] Studio    Video Scripts / Lemonade Stand Explainer        234 pts   [â—‹]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SHOT 3 OF 6  Â·  [Write â—‹] [Shot â—] [Tmpl â—‹]    â”‚  CHAT                               â”‚
â”‚  â—€ Shot 2 Â· Harvest           Shot 4 Â· Craft â–¶   â”‚                                     â”‚
â”‚                                                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ Updated to feel more like a â”‚    â”‚
â”‚  â”‚ VIDEO PROMPT                             â”‚   â”‚  â”‚ montage â€” rapid cuts and    â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚ dynamic close-ups.          â”‚    â”‚
â”‚  â”‚ â”‚ Rapid-cut montage: {{Maya}} squee- â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚ â”‚ zing lemons into a juicer. Juice   â”‚   â”‚   â”‚                                     â”‚
â”‚  â”‚ â”‚ flowing. Overhead + side angles.   â”‚   â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â”‚ {{style_cinematic}}, warm light,   â”‚   â”‚   â”‚       â”‚ yes, suggest narration  â”‚   â”‚
â”‚  â”‚ â”‚ {{scenery_kitchen}} background.    â”‚   â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚                                     â”‚
â”‚  â”‚  [Maya] [style_cinematic] [scenery_kitchen] +â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â†‘ local template chips â€” click to insert   â”‚   â”‚  â”‚ Try: "Watch the magic       â”‚    â”‚
â”‚  â”‚  â”Œâ”€ Autocomplete (on typing {{) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚  â”‚ happen â€” one squeeze at     â”‚    â”‚
â”‚  â”‚  â”‚ â”€ SCRIPT TEMPLATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚   â”‚  â”‚ a time."                    â”‚    â”‚
â”‚  â”‚  â”‚ {{Maya}}            Character          â”‚ â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚  â”‚ {{style_cinematic}} Style              â”‚ â”‚   â”‚                                     â”‚
â”‚  â”‚  â”‚ â”€ GLOBAL TEMPLATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚   â”‚                                     â”‚
â”‚  â”‚  â”‚ {{brand_color}}     Style              â”‚ â”‚   â”‚                                     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                                  â”‚  â”‚ Type a message...  [Send â†µ]   â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ NARRATION                    [â—] Enabled â”‚   â”‚                                     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚                                     â”‚
â”‚  â”‚ â”‚ "Watch the magic happen â€” one      â”‚   â”‚   â”‚                                     â”‚
â”‚  â”‚ â”‚  squeeze at a time."               â”‚   â”‚   â”‚                                     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚                                     â”‚
â”‚  â”‚ â—‹ Use sound from video  â— ElevenLabs     â”‚   â”‚                                     â”‚
â”‚  â”‚ â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„   â”‚   â”‚  â† shown only when narration on      â”‚
â”‚  â”‚ [ğŸ™ Generate Audio]                      â”‚   â”‚    AND ElevenLabs is selected        â”‚
â”‚  â”‚ audio-v1.mp3  3.4s  [â–¶] [ğŸ—‘]            â”‚   â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                     â”‚
â”‚                                                  â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                     â”‚
â”‚  â”‚ GENERATE                                 â”‚   â”‚                                     â”‚
â”‚  â”‚  How many?  [1] [2] [3]  [âœ¨ Generate]   â”‚   â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                     â”‚
â”‚                                                  â”‚                                     â”‚
â”‚  VIDEO HISTORY                                   â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”‚                                     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚       â”‚    â”‚                                     â”‚
â”‚  â”‚ â”‚ [frame] â”‚ â”‚  â”‚ â”‚ [frame] â”‚ â”‚  â”‚  Â·Â·Â·  â”‚    â”‚                                     â”‚
â”‚  â”‚ â”‚â–¶ â”â”â—â”â”â” â”‚ â”‚  â”‚ â”‚â–¶ â”â”â”â”â”â” â”‚ â”‚  â”‚  gen  â”‚    â”‚                                     â”‚
â”‚  â”‚ â”‚0:03/ 8s â”‚ â”‚  â”‚ â”‚0:00/ 8s â”‚ â”‚  â”‚  era  â”‚    â”‚                                     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  ting â”‚    â”‚                                     â”‚
â”‚  â”‚ 2 hrs ago   â”‚  â”‚ 5 hrs ago   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                                     â”‚
â”‚  â”‚[âœ“ Selected] â”‚  â”‚  [Select]   â”‚               â”‚                                     â”‚
â”‚  â”‚ [ğŸ“Œ][â¬‡][ğŸ—‘] â”‚  â”‚  [ğŸ“Œ][â¬‡][ğŸ—‘]â”‚               â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Subtitles [â—] On    Shot 3 of 6    [â—€ Shot 2]                        [Shot 4 â–¶]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Page 5 â€” Templates (/video/templates)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â–£] Studio    Video Templates                                     234 pts   [â—‹]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                        â”‚
â”‚  Use {{ }} variables in prompts. They autocomplete as you type.    [+ New Variable]    â”‚
â”‚                                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [ Characters ]   [ Style ]   [ Scenery ]                                        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  {{Maya}}                                                   [Edit]  [ğŸ—‘]    â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚  â”‚  a young woman in her mid-20s with curly auburn hair, yellow apron,        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  friendly smile, sun-kissed skin, freckles, photorealistic                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Used in: Lemonade Stand (Shots 1, 2, 3, 4)  Â·  Fresh Squeezed (All)      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  {{Barista_Tom}}                                            [Edit]  [ğŸ—‘]    â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚  â”‚  a man in his 30s, short dark hair, white linen shirt, slate-gray          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  apron, warm expression, photorealistic                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Used in: Summer Vibes Promo (Shots 2, 4)                                  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                                  â”‚  â”‚
â”‚  â”‚  [+ Add Character]                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Page 6 â€” All Videos (/video/videos)

All generated videos across every script. Videos are expensive â€” pin good ones from here.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â–£] Studio    All Videos                                          234 pts   [â—‹]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                        â”‚
â”‚  Filter: [All Scripts â–¾]  [All Shots â–¾]              Sort: [Newest first â–¾]           â”‚
â”‚                                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚
â”‚  â”‚ â•‘              â•‘ â”‚  â”‚ â•‘              â•‘ â”‚  â”‚ â•‘              â•‘ â”‚  â”‚ â•‘           â•‘ â”‚  â”‚
â”‚  â”‚ â•‘    [â–¶]       â•‘ â”‚  â”‚ â•‘    [â–¶]       â•‘ â”‚  â”‚ â•‘    [â–¶]       â•‘ â”‚  â”‚ â•‘   [â–¶]     â•‘ â”‚  â”‚
â”‚  â”‚ â•‘              â•‘ â”‚  â”‚ â•‘              â•‘ â”‚  â”‚ â•‘              â•‘ â”‚  â”‚ â•‘           â•‘ â”‚  â”‚
â”‚  â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚
â”‚  â”‚ Lemonade Stand   â”‚  â”‚ Lemonade Stand   â”‚  â”‚ Summer Vibes     â”‚  â”‚ Lemonade      â”‚  â”‚
â”‚  â”‚ Shot 1 Â· v2  âœ“  â”‚  â”‚ Shot 3 Â· v1      â”‚  â”‚ Shot 2 Â· v1  âœ“  â”‚  â”‚ Shot 1 Â· v1   â”‚  â”‚
â”‚  â”‚ 2 hours ago      â”‚  â”‚ 5 hours ago      â”‚  â”‚ yesterday        â”‚  â”‚ 3 days ago    â”‚  â”‚
â”‚  â”‚ [ğŸ“Œ Pin] [â¬‡] [ğŸ—‘]â”‚  â”‚ [ğŸ“Œ Pin] [â¬‡] [ğŸ—‘]â”‚  â”‚ [ğŸ“Œ Pin] [â¬‡] [ğŸ—‘]â”‚  â”‚ [ğŸ“Œ Pin] [â¬‡]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚                                           â”‚
â”‚  â”‚ â•‘              â•‘ â”‚  â”‚ â•‘              â•‘ â”‚                                           â”‚
â”‚  â”‚ â•‘    [â–¶]  ğŸ“Œ   â•‘ â”‚  â”‚ â•‘    [â–¶]       â•‘ â”‚                                           â”‚
â”‚  â”‚ â•‘              â•‘ â”‚  â”‚ â•‘              â•‘ â”‚                                           â”‚
â”‚  â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚                                           â”‚
â”‚  â”‚ Lemonade Stand   â”‚  â”‚ Summer Vibes     â”‚                                           â”‚
â”‚  â”‚ Shot 2 Â· v3  ğŸ“Œ  â”‚  â”‚ Shot 4 Â· v2      â”‚                                           â”‚
â”‚  â”‚ 4 days ago       â”‚  â”‚ 4 days ago       â”‚                                           â”‚
â”‚  â”‚ [ğŸ“Œ Unpin][â¬‡][ğŸ—‘] â”‚  â”‚ [ğŸ“Œ Pin] [â¬‡] [ğŸ—‘]â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Page 7 â€” Pinned Videos (/video/videos/pinned)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â–£] Studio    Pinned Videos                                       234 pts   [â—‹]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                        â”‚
â”‚  Videos you've pinned for safekeeping. Generation is expensive â€” pin the good ones.   â”‚
â”‚                                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚                                           â”‚
â”‚  â”‚ â•‘              â•‘ â”‚  â”‚ â•‘              â•‘ â”‚                                           â”‚
â”‚  â”‚ â•‘    [â–¶]  ğŸ“Œ   â•‘ â”‚  â”‚ â•‘    [â–¶]  ğŸ“Œ   â•‘ â”‚                                           â”‚
â”‚  â”‚ â•‘              â•‘ â”‚  â”‚ â•‘              â•‘ â”‚                                           â”‚
â”‚  â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚                                           â”‚
â”‚  â”‚ Lemonade Stand   â”‚  â”‚ Summer Vibes     â”‚                                           â”‚
â”‚  â”‚ Shot 2 Â· v3      â”‚  â”‚ Shot 2 Â· v1  âœ“  â”‚                                           â”‚
â”‚  â”‚ Pinned 4 days agoâ”‚  â”‚ Pinned yesterday â”‚                                           â”‚
â”‚  â”‚ [ğŸ“Œ Unpin][â¬‡][â†’] â”‚  â”‚ [ğŸ“Œ Unpin][â¬‡][â†’] â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                                                        â”‚
â”‚  âœ“ = currently selected take in its script     [â†’] = open in script editor            â”‚
â”‚                                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# !/usr/bin/env python3

"""
Generate lemonade video clips + TTS narration + background music via Poe API,
merge and stitch with ffmpeg.

Usage:
  python3 generate_video.py            # full run (skips completed steps)
  python3 generate_video.py --remerge  # redo merge + stitch only (keeps video/audio/music)
  python3 generate_video.py --regen    # interactive: pick clips to regenerate

Requires: pip install openai requests python-dotenv questionary
"""

import hashlib
import json
import os
import subprocess
import threading
from concurrent.futures import ThreadPoolExecutor, as_completed
from pathlib import Path

import openai
import requests
from dotenv import load_dotenv

load_dotenv(Path(__file__).parent / ".env")

API_KEY = os.environ["POE_API_KEY"]
BASE_DIR = Path(__file__).parent
OUTPUT_DIR = BASE_DIR / "video_clips"
AUDIO_DIR = BASE_DIR / "audio_clips"
MUSIC_DIR = BASE_DIR / "music"
MERGED_DIR = BASE_DIR / "merged_clips"
SUBS_DIR = BASE_DIR / "subtitles"
BACKUP_DIR = BASE_DIR / "backup"
FINAL_OUTPUT = BASE_DIR / "lemonade_final.mp4"
STATE_FILE = BASE_DIR / "state.json"

VIDEO_DURATION = 8.0       # veo-3.1 generates 8s clips
AUDIO_MAX = 7.0            # narration should be under this to leave padding
AUDIO_MIN = 4.0            # reject too-short audio
NUM_AUDIO_ALTERNATIVES = 3 # generate this many, pick best fit
MUSIC_VOLUME = 0.08        # background music volume (0.0 - 1.0), very quiet under narration
VIDEO_PARALLEL = 10        # max concurrent video generation requests
AUDIO_PARALLEL = 10        # max concurrent audio generation requests

MUSIC_PROMPT = (
    "Gentle upbeat ukulele and light percussion background music for an animated "
    "explainer video. Cheerful, warm, simple melody. No vocals. "
    "Light and airy, suitable as background under narration."
)

# Style prefix applied to every video prompt

STYLE = (
    "Isometric 2.5D corporate explainer animation. "
    "Navy, coral, gold palette. Minimal faces, vector style, simple, no text overlays. "
)

# Consistent character descriptions

ANA = "a tall woman with brown hair, glasses, yellow apron"
BEN = "a short stocky man with red curly hair and beard, green apron"
TRUCK = "a white delivery truck with a red cab"

# Each clip: (name, video_prompt, narration_text)

CLIPS = [
    (
        "01_street_stands",
        f"Sunny street, two lemonade stands. Left: {ANA}, busy with customers. Right: {BEN}, no customers.",
        [
            "Meet Ana and Ben. They both sell lemonade at the same market. Every morning, a truck brings their lemons from the farm.",
            "Meet Ana and Ben. They sell lemonade at the same market. A truck delivers their lemons each morning.",
            "Meet Ana and Ben. They sell lemonade at the same market.",
        ],
    ),
    (
        "02_boxes_needed",
        f"{ANA} next to a huge tower of lemon boxes. {BEN} next to a tiny pile. Big contrast.",
        [
            "Ana sells a LOT of lemonade. She needs 90 boxes of lemons every single day. Ben? He only needs 10.",
            "Ana needs 90 boxes of lemons every day. Ben only needs 10.",
            "Ana needs 90 boxes daily. Ben needs just 10.",
        ],
    ),
    (
        "03_truck_arrives",
        f"{TRUCK} drives in and stops. Rear doors swing open showing empty cargo.",
        [
            "The truck fits exactly 100 boxes and costs 100 dollars per trip. No matter how full it is. Empty truck? 100 dollars. Full truck? 100 dollars.",
            "The truck holds 100 boxes and costs 100 dollars per trip, no matter how full it is.",
            "The truck costs 100 dollars per trip, no matter how full.",
        ],
    ),
    (
        "04_truck_loaded",
        f"Rear view of {TRUCK}, rear door open, cargo packed full. Blue boxes left, red boxes right. No space left.",
        [
            "Together, Ana's 90 boxes and Ben's 10 boxes fill the truck perfectly to capacity.",
            "Together, Ana and Ben fill it up perfectly. The truck is completely full.",
            "Together, Ana and Ben fill the truck perfectly. Great!",
        ],
    ),
    (
        "05_calculator",
        "{ANA} sitting at the desk and typing into calculator, calculator shows $1.00",
        [
            "So they decide to split the bill based on how many boxes each one sends. 100 dollars divided by 100 boxes equals 1 dollar per box. Simple!",
            "So they split the bill per box. 100 divided by 100 equals 1 dollar per box. Simple.",
            "They split it per box. One dollar per box.",
        ],
    ),
    (
        "06_paying",
        f"{ANA} behind a tall stack of bills. {BEN} behind a tiny stack. Big difference.",
        [
            "Ana pays 90 dollars for her 90 boxes. Ben pays 10 dollars for his 10 boxes. Seems fair, right? But let's look closer.",
            "Ana pays 90 dollars. Ben pays 10 dollars. Seems fair, right? But let's look closer.",
            "Ana pays 90. Ben pays 10. Seems fair. But let's look closer.",
        ],
    ),
    (
        "07_ben_alone",
        f"{BEN} alone next to {TRUCK}, rear doors open. Only a few boxes inside. He looks small.",
        [
            "What if Ben had to get his own delivery truck? He still needs just 10 boxes, but the truck still costs 100 dollars.",
            "What if Ben needed his own truck? Still 10 boxes, but the truck still costs 100 dollars.",
            "What if Ben needed his own truck? Still 10 boxes, still 100 dollars.",
        ],
    ),
    (
        "08_ten_per_box",
        f"{BEN} frozen in shock holding a paper. Money floats away from his pockets.",
        [
            "That's 10 dollars per box! TEN times more expensive than what he was paying when sharing with Ana.",
            "That's 10 dollars per box. Ten times more expensive than before!",
            "That's 10 dollars per box. Ten times more than what he paid before!",
        ],
    ),
    (
        "09_ana_alone",
        f"{ANA} calm next to {TRUCK}, cargo full of blue boxes. She shrugs.",
        [
            "And what about Ana on her own? 100 dollars divided by 90 boxes is about 1 dollar 11 per box. Barely any different from before.",
            "And Ana alone? About 1 dollar 11 per box. Barely different.",
            "Ana alone pays 1 dollar 11. Barely changed.",
        ],
    ),
    (
        "10_discount_badge",
        f"{BEN} alone, slumped. A large price tag hangs above him.",
        [
            "Ben was getting a 90 percent discount. Not because he's efficient, but because Ana's volume was absorbing almost all the truck cost.",
            "Ben got a 90 percent discount, just because Ana's volume fills the truck.",
            "Ben got a 90 percent discount thanks to Ana.",
        ],
    ),
    (
        "11_free_ride",
        f"{BEN} relaxed in a shopping cart with sunglasses. {ANA} pulling it with a rope.",
        [
            "In other words, Ben was getting a free ride. He's paying almost nothing because Ana is covering the truck cost.",
            "Ben was getting a free ride. Ana's volume covered nearly all the cost.",
            "In other words, Ben was getting a free ride.",
        ],
    ),
    (
        "12_misleading",
        "Man in a suit at a desk comparing two papers. He picks the wrong one confidently.",
        [
            "Now imagine a manager comparing costs across locations. The shared truck makes Ben's cost look amazing. But it's an illusion created by Ana's volume.",
            "If a manager compares costs, Ben's location looks ten times cheaper. But that's an illusion. It only looks cheap because Ana is there.",
            "To a manager comparing costs, Ben looks incredibly efficient. But it's all Ana.",
        ],
    ),
    (
        "13_ana_leaves",
        f"Split screen. Left: {ANA} walks away waving goodbye, her lemonade stand disappearing. "
        f"Right: {BEN} stares at a giant price tag flipping from '$1' to '$10'. "
        f"The '$10' flashes red. Sky darkens behind him.",
        [
            "If Ana leaves, Ben's cost jumps from 1 dollar to 10 dollars overnight.",
            "Ana leaves. Ben's cost jumps to 10 dollars.",
            "Ana leaves. Ben pays ten times more.",
        ],
    ),
    (
        "14_real_lesson",
        "Whiteboard. Large circle and small circle inside a rectangle. Arrow from large to small.",
        [
            "Splitting fixed costs by volume hides a subsidy. Small players look cheap.",
            "Volume-based splits hide subsidies. Small looks cheap.",
            "Splitting by volume hides the real cost.",
        ],
    ),
    (
        "19_closing",
        f"Golden hour. Two lemonade stands. {ANA} and {BEN} each serving customers. {TRUCK} behind them.",
        [
            "Next time you split a fixed cost, ask yourself: who is really paying, and who is just along for the ride?",
            "Next time you split a fixed cost, ask: who is really paying, and who is along for the ride?",
            "So next time, ask: who is really paying?",
        ],
    ),
]

# --- State management ---

def load_state() -> dict:
    # Try current location first, fall back to old location
    old_state_file = OUTPUT_DIR / "state.json"
    if STATE_FILE.exists():
        state = json.loads(STATE_FILE.read_text())
    elif old_state_file.exists():
        state = json.loads(old_state_file.read_text())
    else:
        state = {}

    # Migrate old-format keys ("01_street_stands") to new format ("video:01_street_stands")
    keys_to_migrate = [k for k in state if not k.startswith(("video:", "audio:", "merged:", "music"))]
    for k in keys_to_migrate:
        state[f"video:{k}"] = state.pop(k)

    return state

_state_lock = threading.Lock()

def save_state(state: dict):
    with_state_lock:
        tmp = STATE_FILE.with_suffix(".tmp")
        tmp.write_text(json.dumps(state, indent=2))
        tmp.rename(STATE_FILE)

# --- Helpers ---

def prompt_hash(text: str) -> str:
    """Short stable hash of a prompt string."""
    return hashlib.sha256(text.encode()).hexdigest()[:12]

def backup_file(path: Path):
    """Move file to backup dir with timestamp prefix."""
    if not path.exists():
        return
    BACKUP_DIR.mkdir(exist_ok=True)
    from datetime import datetime
    ts = datetime.now().strftime("%Y%m%d_%H%M%S")
    stem = path.stem
    dest = BACKUP_DIR / f"{stem}_{ts}{path.suffix}"
    path.rename(dest)
    print(f"    Backed up {path.name} -> backup/{dest.name}")

def get_duration(path: Path) -> float | None:
    """Get media duration in seconds via ffprobe."""
    try:
        r = subprocess.run(
            ["ffprobe", "-v", "error", "-show_entries", "format=duration",
             "-of", "csv=p=0", str(path)],
            capture_output=True, text=True, timeout=10,
        )
        return float(r.stdout.strip())
    except Exception:
        return None

def is_valid_media(path: Path, media_type: str = "video") -> bool:
    """Check if file is valid video or audio using ffprobe."""
    stream = "v:0" if media_type == "video" else "a:0"
    try:
        r = subprocess.run(
            ["ffprobe", "-v", "error", "-select_streams", stream,
             "-show_entries", "stream=codec_type", "-of", "csv=p=0", str(path)],
            capture_output=True, text=True, timeout=10,
        )
        return media_type in r.stdout
    except Exception:
        return False

def download_file(url: str, dest: Path) -> bool:
    """Download URL to dest atomically (via temp file)."""
    tmp = dest.with_suffix(dest.suffix + ".tmp")
    try:
        r = requests.get(url, timeout=300, stream=True)
        r.raise_for_status()
        with open(tmp, "wb") as f:
            for chunk in r.iter_content(chunk_size=8192):
                f.write(chunk)
        tmp.rename(dest)
        print(f"    Saved {dest.name} ({dest.stat().st_size / 1024:.0f} KB)")
        return True
    except Exception as e:
        print(f"    ERROR downloading {dest.name}: {e}")
        if tmp.exists():
            tmp.unlink()
        return False

# --- Video generation ---

def generate_video(client: openai.OpenAI, name: str, prompt: str, state: dict) -> Path | None:
    """Generate video clip. Returns path if successful."""
    dest = OUTPUT_DIR / f"{name}.mp4"
    clip_state = state.get(f"video:{name}", {})
    full_prompt = STYLE + prompt
    phash = prompt_hash(full_prompt)

    # Prompt changed or no hash stored â€” backup old file and invalidate
    if clip_state.get("hash") != phash:
        if clip_state.get("hash"):
            print(f"  Video: prompt changed (hash {clip_state['hash'][:8]}â†’{phash[:8]}), regenerating")
        elif dest.exists():
            print(f"  Video: no hash stored, regenerating")
        backup_file(dest)
        clip_state = {}
        state[f"video:{name}"] = clip_state
        save_state(state)

    # File exists on disk with matching hash â€” skip
    if dest.exists() and dest.stat().st_size > 0:
        if not clip_state.get("done"):
            state[f"video:{name}"] = {**clip_state, "done": True, "hash": phash}
            save_state(state)
        print(f"  Video: skipping (exists on disk)")
        return dest

    # Retry download from cached URL
    saved_url = clip_state.get("url")
    if saved_url and not (dest.exists() and dest.stat().st_size > 0):
        print(f"  Video: retrying download (URL cached)")
        if download_file(saved_url, dest):
            state[f"video:{name}"] = {"url": saved_url, "done": True, "hash": phash}
            save_state(state)
            return dest
        print(f"  Video: cached URL failed, regenerating")
    print(f"  Video: generating...")
    try:
        resp = client.chat.completions.create(
            model="veo-3.1",
            messages=[{"role": "user", "content": full_prompt}],
            extra_body={"size": "1792x1024", "duration": "8"},
        )
        url = resp.choices[0].message.content.strip()
    except Exception as e:
        print(f"  Video: ERROR {e}")
        return None

    # Save URL immediately
    state[f"video:{name}"] = {"url": url, "done": False, "hash": phash}
    save_state(state)

    if download_file(url, dest):
        state[f"video:{name}"]["done"] = True
        save_state(state)
        return dest

    return None

# --- Audio generation ---

def _audio_ok(dur: float) -> bool:
    return AUDIO_MIN <= dur <= AUDIO_MAX

def generate_audio(client: openai.OpenAI, name: str, narrations: list[str], state: dict) -> Path | None:
    """Generate narration for each text variant via elevenlabs-v3. Pick best between 4-7s."""
    import glob as globmod

    target = (AUDIO_MIN + AUDIO_MAX) / 2  # 5.5s ideal
    nhash = prompt_hash("\n".join(narrations))
    audio_state = state.get(f"audio:{name}", {})

    # Narration text changed or no hash stored â€” clear old audio files
    if audio_state.get("hash") != nhash:
        if audio_state.get("hash"):
            print(f"  Audio: narration changed (hash {audio_state['hash'][:8]}â†’{nhash[:8]}), regenerating")
        else:
            print(f"  Audio: no hash stored, regenerating")
        pattern = str(AUDIO_DIR / f"{name}_v*.mp3")
        for old in globmod.glob(pattern):
            backup_file(Path(old))
        state[f"audio:{name}"] = {"hash": nhash}
        save_state(state)

    # Check existing files first
    pattern = str(AUDIO_DIR / f"{name}_v*.mp3")
    existing = sorted(globmod.glob(pattern))

    candidates = []
    for f in existing:
        p = Path(f)
        dur = get_duration(p)
        if dur and _audio_ok(dur):
            candidates.append((p, dur))
            print(f"  Audio: {p.name} = {dur:.1f}s (ok)")
        elif dur:
            print(f"  Audio: {p.name} = {dur:.1f}s (out of range {AUDIO_MIN}-{AUDIO_MAX}s)")

    # If we already have a good candidate, use it
    if candidates:
        best_path, best_dur = min(candidates, key=lambda x: abs(x[1] - target))
        print(f"  Audio: picked {best_path.name} ({best_dur:.1f}s)")
        state[f"audio:{name}"] = {"hash": nhash, "done": True}
        save_state(state)
        return best_path

    # Generate one audio per narration variant (short/medium/long text)
    next_idx = len(existing) + 1
    for i, text in enumerate(narrations):
        idx = next_idx + i
        dest = AUDIO_DIR / f"{name}_v{idx}.mp3"
        print(f"  Audio: generating v{idx} ({len(text.split())} words): {text[:60]}...")
        try:
            resp = client.chat.completions.create(
                model="elevenlabs-v3",
                messages=[{"role": "user", "content": text}],
            )
            url = resp.choices[0].message.content.strip()
        except Exception as e:
            print(f"  Audio: ERROR generating v{idx}: {e}")
            continue

        if download_file(url, dest):
            dur = get_duration(dest)
            if dur and _audio_ok(dur):
                candidates.append((dest, dur))
                print(f"  Audio: v{idx} = {dur:.1f}s (ok)")
            elif dur:
                print(f"  Audio: v{idx} = {dur:.1f}s (out of range)")
            else:
                print(f"  Audio: v{idx} = unknown duration")

    if not candidates:
        print(f"  Audio: no candidate in {AUDIO_MIN}-{AUDIO_MAX}s for {name}")
        return None

    best_path, best_dur = min(candidates, key=lambda x: abs(x[1] - target))
    print(f"  Audio: picked {best_path.name} ({best_dur:.1f}s)")
    state[f"audio:{name}"] = {"hash": nhash, "done": True}
    save_state(state)
    return best_path

# --- Background music generation ---

def generate_music(client: openai.OpenAI, state: dict) -> Path | None:
    """Generate background music track via lyria. Returns path if successful."""
    music_state = state.get("music", {})
    dest = MUSIC_DIR / "background.mp3"

    # Already done
    if music_state.get("done") and dest.exists() and dest.stat().st_size > 0:
        print("Music: skipping (done)")
        return dest

    # Retry download from cached URL
    saved_url = music_state.get("url")
    if saved_url and not (dest.exists() and dest.stat().st_size > 0):
        print("Music: retrying download (URL cached)")
        if download_file(saved_url, dest):
            state["music"] = {"url": saved_url, "done": True}
            save_state(state)
            return dest
        print("Music: cached URL failed, regenerating")

    # Generate
    print("Music: generating via lyria...")
    try:
        resp = client.chat.completions.create(
            model="lyria",
            messages=[{"role": "user", "content": MUSIC_PROMPT}],
        )
        url = resp.choices[0].message.content.strip()
    except Exception as e:
        print(f"Music: ERROR {e}")
        return None

    # Save URL immediately
    state["music"] = {"url": url, "done": False}
    save_state(state)

    if download_file(url, dest):
        dur = get_duration(dest)
        print(f"  Music duration: {dur:.1f}s" if dur else "  Music duration: unknown")
        state["music"]["done"] = True
        save_state(state)
        return dest

    return None

# --- Subtitle generation via parakeet-mlx ---

_parakeet_model = None
_parakeet_lock = threading.Lock()

def _get_parakeet():
    """Lazy-load parakeet model (once)."""
    global _parakeet_model
    if _parakeet_model is None:
        with _parakeet_lock:
            if _parakeet_model is None:
                from parakeet_mlx import from_pretrained
                print("  Loading parakeet-mlx model...")
                _parakeet_model = from_pretrained("mlx-community/parakeet-tdt-0.6b-v3")
    return_parakeet_model

def _fmt_srt_time(seconds: float) -> str:
    """Format seconds as SRT timestamp: HH:MM:SS,mmm"""
    h = int(seconds // 3600)
    m = int((seconds % 3600) // 60)
    s = int(seconds % 60)
    ms = int((seconds % 1) * 1000)
    return f"{h:02d}:{m:02d}:{s:02d},{ms:03d}"

def generate_subtitles(name: str, audio_path: Path, delay_s: float) -> Path | None:
    """Transcribe audio with parakeet-mlx, generate SRT with timestamps offset by delay_s."""
    srt_path = SUBS_DIR / f"{name}.srt"

    model = _get_parakeet()
    print(f"  Subs: transcribing {audio_path.name}...")
    try:
        result = model.transcribe(str(audio_path))
    except Exception as e:
        print(f"  Subs: ERROR transcribing: {e}")
        return None

    # Merge BPE sub-word tokens into whole words (tokens starting with space = new word)
    words = []
    for sentence in result.sentences:
        cur_text = ""
        cur_start = None
        cur_end = None
        for token in sentence.tokens:
            if token.text.startswith(" ") and cur_text:
                words.append((cur_text, cur_start + delay_s, cur_end + delay_s))
                cur_text = token.text.strip()
                cur_start = token.start
                cur_end = token.end
            else:
                if cur_start is None:
                    cur_start = token.start
                cur_text += token.text.strip()
                cur_end = token.end
        if cur_text:
            words.append((cur_text, cur_start + delay_s, cur_end + delay_s))

    # Group words into subtitle chunks (~3-5 words each)
    subs = []
    chunk_words = []
    chunk_start = None
    chunk_end = None
    for text, start, end in words:
        if not text:
            continue
        if chunk_start is None:
            chunk_start = start
        chunk_words.append(text)
        chunk_end = end
        if len(chunk_words) >= 5 or (text.endswith(('.', '!', '?', ',')) and len(chunk_words) >= 3):
            subs.append((chunk_start, chunk_end, " ".join(chunk_words)))
            chunk_words = []
            chunk_start = None
            chunk_end = None
    if chunk_words:
        subs.append((chunk_start, chunk_end, " ".join(chunk_words)))

    # Write SRT
    with open(srt_path, "w") as f:
        for i, (start, end, text) in enumerate(subs, 1):
            f.write(f"{i}\n{_fmt_srt_time(start)} --> {_fmt_srt_time(end)}\n{text}\n\n")

    print(f"  Subs: {len(subs)} entries -> {srt_path.name}")
    return srt_path

def _parse_srt(srt_path: Path) -> list[tuple[float, float, str]]:
    """Parse SRT file into list of (start_sec, end_sec, text)."""
    import re
    entries = []
    content = srt_path.read_text()
    blocks = re.split(r"\n\n+", content.strip())
    for block in blocks:
        lines = block.strip().split("\n")
        if len(lines) < 3:
            continue
        m = re.match(r"(\d{2}):(\d{2}):(\d{2}),(\d{3})\s*-->\s*(\d{2}):(\d{2}):(\d{2}),(\d{3})", lines[1])
        if not m:
            continue
        g = [int(x) for x in m.groups()]
        start = g[0] *3600 + g[1]* 60 + g[2] + g[3] / 1000
        end = g[4] *3600 + g[5]* 60 + g[6] + g[7] / 1000
        text = " ".join(lines[2:])
        entries.append((start, end, text))
    return entries

def _burn_subtitles(video_path: Path, srt_path: Path, dest: Path) -> bool:
    """Burn subtitles into video using moviepy."""
    from moviepy import VideoFileClip, TextClip, CompositeVideoClip

    subs = _parse_srt(srt_path)
    if not subs:
        video_path.rename(dest)
        return True

    try:
        video = VideoFileClip(str(video_path))
        txt_clips = []
        for start, end, text in subs:
            tc = TextClip(
                text=text,
                font="/System/Library/Fonts/Helvetica.ttc",
                font_size=max(24, video.h // 20),
                color="white",
                stroke_color="black",
                stroke_width=2,
            )
            tc = tc.with_position(("center", video.h - tc.h - max(40, video.h // 12)))
            tc = tc.with_start(start).with_end(end)
            txt_clips.append(tc)

        final = CompositeVideoClip([video, *txt_clips])
        final.write_videofile(
            str(dest),
            codec="libx264",
            audio_codec="aac",
            logger=None,
        )
        final.close()
        video.close()
        print(f"  Subs: burned {len(subs)} entries into video")
        return True
    except Exception as e:
        print(f"  Subs: ERROR burning subtitles: {e}")
        return False

# --- Merge video + narration + subtitles ---

def merge_clip(name: str, video_path: Path, audio_path: Path, state: dict) -> Path | None:
    """Merge video + narration + burned-in subtitles with ffmpeg."""
    dest = MERGED_DIR / f"{name}.mp4"
    merge_state = state.get(f"merged:{name}", {})

    if merge_state.get("done") and dest.exists() and dest.stat().st_size > 0:
        print(f"  Merge: skipping (done)")
        return dest

    audio_dur = get_duration(audio_path)
    video_dur = get_duration(video_path) or VIDEO_DURATION

    if audio_dur is None:
        print(f"  Merge: cannot read audio duration")
        return None

    # Center the audio: equal padding before and after
    delay_s = max(0, (video_dur - audio_dur) / 2)
    delay_ms = int(delay_s * 1000)

    print(f"  Merge: video={video_dur:.1f}s, audio={audio_dur:.1f}s, delay={delay_ms}ms")

    # Generate subtitles with parakeet-mlx
    srt_path = generate_subtitles(name, audio_path, delay_s)

    # Step 1: merge video + delayed audio (no subtitles yet)
    tmp_merged = dest.with_suffix(".tmp.mp4")
    cmd_merge = [
        "ffmpeg", "-y",
        "-i", str(video_path),
        "-i", str(audio_path),
        "-filter_complex",
        f"[1:a]adelay={delay_ms}|{delay_ms},apad=whole_dur={video_dur}[a]",
        "-map", "0:v",
        "-map", "[a]",
        "-c:v", "copy",
        "-c:a", "aac",
        "-b:a", "192k",
        "-shortest",
        str(tmp_merged),
    ]

    try:
        subprocess.run(cmd_merge, check=True, capture_output=True, text=True)
    except subprocess.CalledProcessError as e:
        print(f"  Merge: ERROR (audio merge)\n{e.stderr}")
        return None

    # Step 2: burn subtitles using PIL if we have an SRT
    if srt_path and srt_path.exists():
        ok = _burn_subtitles(tmp_merged, srt_path, dest)
        tmp_merged.unlink(missing_ok=True)
        if not ok:
            return None
    else:
        tmp_merged.rename(dest)

    state[f"merged:{name}"] = {"done": True}
    save_state(state)
    print(f"  Merge: saved {dest.name}")
    return dest

# --- Stitch + background music ---

def stitch_clips(clip_paths: list[Path], music_path: Path | None, output: Path):
    """Concatenate clips, then overlay looped background music at low volume."""
    filelist = output.parent / "filelist.txt"
    with open(filelist, "w") as f:
        for p in clip_paths:
            f.write(f"file '{p.resolve()}'\n")

    if music_path is None:
        # No music â€” simple concat
        cmd = [
            "ffmpeg", "-y",
            "-f", "concat", "-safe", "0",
            "-i", str(filelist),
            "-c", "copy",
            str(output),
        ]
        print(f"\nStitching {len(clip_paths)} clips (no music)...")
        subprocess.run(cmd, check=True)
    else:
        # Two-step: concat video first, then mix in looped music
        concat_tmp = output.with_name("concat_tmp.mp4")

        # Step 1: concat all merged clips
        cmd_concat = [
            "ffmpeg", "-y",
            "-f", "concat", "-safe", "0",
            "-i", str(filelist),
            "-c", "copy",
            str(concat_tmp),
        ]
        print(f"\nStitching {len(clip_paths)} clips...")
        subprocess.run(cmd_concat, check=True)

        total_dur = get_duration(concat_tmp) or (len(clip_paths) * VIDEO_DURATION)

        # Step 2: overlay looped music at low volume
        # Use volume filters instead of amix (which normalizes and halves everything)
        cmd_music = [
            "ffmpeg", "-y",
            "-i", str(concat_tmp),
            "-stream_loop", "-1", "-i", str(music_path),
            "-filter_complex",
            f"[0:a]volume=1.0[voice];"
            f"[1:a]volume={MUSIC_VOLUME},atrim=0:{total_dur},asetpts=PTS-STARTPTS[music];"
            f"[voice][music]amix=inputs=2:duration=first:dropout_transition=2:normalize=0[out]",
            "-map", "0:v",
            "-map", "[out]",
            "-c:v", "copy",
            "-c:a", "aac",
            "-b:a", "192k",
            str(output),
        ]
        print(f"Adding background music (volume={MUSIC_VOLUME})...")
        subprocess.run(cmd_music, check=True)
        concat_tmp.unlink()

    filelist.unlink()
    print(f"Final video: {output}")

# --- Main ---

def main():
    for d in [OUTPUT_DIR, AUDIO_DIR, MUSIC_DIR, MERGED_DIR, SUBS_DIR, BACKUP_DIR]:
        d.mkdir(exist_ok=True)

    client = openai.OpenAI(api_key=API_KEY, base_url="https://api.poe.com/v1")
    state = load_state()

    # Always redo merge + stitch (video/audio/music generation is still skipped if done)
    keys_to_clear = [k for k in state if k.startswith("merged:")]
    if keys_to_clear:
        for k in keys_to_clear:
            del state[k]
        save_state(state)

    # Phase 0: Background music (one track, generated once)
    print("=== Phase 0: Background music ===")
    music_path = generate_music(client, state)
    if not music_path:
        print("WARNING: No background music, will continue without it\n")

    # Phase 1: Generate all videos in parallel
    print(f"\n=== Phase 1: Video generation ({VIDEO_PARALLEL} parallel) ===")
    video_results: dict[str, Path | None] = {}
    with ThreadPoolExecutor(max_workers=VIDEO_PARALLEL) as pool:
        futures = {
            pool.submit(generate_video, client, name, video_prompt, state): name
            for name, video_prompt, _ in CLIPS
        }
        for future in as_completed(futures):
            name = futures[future]
            try:
                video_results[name] = future.result()
            except Exception as e:
                print(f"  [{name}] Video: EXCEPTION {e}")
                video_results[name] = None

    # Phase 2: Generate all audio in parallel
    print(f"\n=== Phase 2: Audio generation ({AUDIO_PARALLEL} parallel) ===")
    audio_results: dict[str, Path | None] = {}
    with ThreadPoolExecutor(max_workers=AUDIO_PARALLEL) as pool:
        futures = {
            pool.submit(generate_audio, client, name, narration, state): name
            for name, _, narration in CLIPS
        }
        for future in as_completed(futures):
            name = futures[future]
            try:
                audio_results[name] = future.result()
            except Exception as e:
                print(f"  [{name}] Audio: EXCEPTION {e}")
                audio_results[name] = None

    # Phase 3: Merge video + narration (sequential â€” fast, CPU-bound)
    print("\n=== Phase 3: Merge ===")
    merged_paths: list[Path] = []
    failed: list[str] = []

    for name, _, _ in CLIPS:
        print(f"\n  [{name}]")
        video_path = video_results.get(name)
        audio_path = audio_results.get(name)

        if not video_path:
            print(f"  FAILED (video)")
            failed.append(name)
            continue
        if not audio_path:
            print(f"  FAILED (audio)")
            failed.append(name)
            continue

        merged_path = merge_clip(name, video_path, audio_path, state)
        if not merged_path:
            print(f"  FAILED (merge)")
            failed.append(name)
            continue

        merged_paths.append(merged_path)

    # Phase 4: Stitch all + background music
    if merged_paths:
        stitch_clips(merged_paths, music_path, FINAL_OUTPUT)
        print(f"\nDone! {len(merged_paths)}/{len(CLIPS)} clips -> {FINAL_OUTPUT}")
    else:
        print("\nNo clips generated.")

    if failed:
        print(f"\nFailed ({len(failed)}): {', '.join(failed)}")
        print("Re-run to retry.")

if __name__ == "__main__":
    main()

---

# Implementation Notes

Cross-check against the existing codebase. Items that need work before the video feature can ship.

## Inconsistencies & Missing Pieces

| Area | Finding | Priority |
|---|---|---|
| **SharedHome** | Missing Video tab â€” only Music and Image currently | HIGH |
| **LLMClient** | No `generateVideo()` method; `PoeLLMClient` needs extending | HIGH |
| **Handlebars templating** | `{{variable}}` syntax is completely net-new â€” no library, no storage, no UI | HIGH |
| **YAML serialisation** | `js-yaml` (or equivalent) not in deps; YAML export is net-new | HIGH |
| **TopBar icon** | Hardcoded to Music icon; Image has its own override â€” video needs the same pattern | MEDIUM |
| **Split pane** | Currently inlined inside `LyricsGenerator`; not a reusable component. Video editor needs the same layout â€” extract or duplicate | MEDIUM |
| **Breadcrumb** | No `/video/*` route mappings; needs entries for scripts, editor, videos, pinned, templates | MEDIUM |
| **Video model** | `pinned: boolean` field doesn't exist yet; pinning pattern is established elsewhere (just add the field) | MEDIUM |
| **NavMenu** | Already generic â€” just needs a `VIDEO_NAV_ITEMS` constant (Scripts, All Videos, Pinned, Templates, Settings) | LOW |
| **Mobile breakpoint** | 768px split-pane pattern confirmed consistent across Music and Image â€” no change needed | âœ“ |

## What Can Be Reused As-Is

| Component / Pattern | Notes |
|---|---|
| `NavMenu` | Already accepts an items array â€” just pass `VIDEO_NAV_ITEMS` |
| `Breadcrumb` | Extend the existing route map with `/video/*` paths |
| `FileDropzone` | Reusable for any future video/audio file inputs |
| `usePoeBalanceContext()` | Balance display in TopBar works unchanged |
| Pinning pattern | Boolean field + filter query â€” mirrors existing implementation |
| All `shadcn/ui` components | Cards, tabs, dialogs, dropdowns, badges, sliders â€” available |
| 768px split-pane / tab fallback | Established pattern â€” replicate for Script editor |
| Chat panel UI | Right-aligned user bubbles, left-aligned assistant cards â€” reuse styling |

## Notes on Handlebars Templates

The `{{variable_name}}` syntax is the highest-risk net-new piece:

- **Storage**: templates live in the `templates` block of the YAML (local, `global: false`) and in a separate global templates collection (`/video/templates`).
- **Rendering**: at YAML export time, global templates are NOT written into the file â€” only a reference is resolved. Local templates are written inline.
- **UI needs**: syntax highlighting inside the prompt textarea, `{{` autocomplete dropdown (section-divided: Script Templates / Global Templates), and subtle read-only chips below the textarea showing which variables are active in that shot.
- **Library options**: `handlebars` (npm) for rendering; **`tiptap`** for the prompt input. Tiptap treats `{{variable}}` as atomic inline nodes â€” clicking selects the whole thing, backspace deletes it cleanly, and it renders as a styled chip inside the text. Fully styleable to look like a normal polished textarea. The `contenteditable` + overlay approach breaks down with atomic node selection, so tiptap is the right call.
